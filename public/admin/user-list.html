<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title></title>
    <!-- Bootstrap -->
    <link href="lib/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="css/base.css"/>
    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">CMS管理系统</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- <li><a href="#">Link</a></li> -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">
                        admin
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#">个人资料</a></li>
                        <li><a href="#">通知信息</a></li>
                        <li><a href="#">收到的评论</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">退出登录</a></li>
                    </ul>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>
<div class="main">
    <div class="left-side">
        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading1">
                    <h4 class="panel-title">
                        <a role="button" href="#">
                            <span class="glyphicon glyphicon-fire"></span>
                            信息面板
                        </a>
                    </h4>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading2">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                           href="#collapse2"
                           aria-expanded="false" aria-controls="collapseTwo">
                            <span class="glyphicon glyphicon-tasks"></span>
                            文章管理
                        </a>
                    </h4>
                </div>
                <div id="collapse2" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="article-list.html">
                                <span class="glyphicon glyphicon-th-list"></span>
                                文章列表
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="article-add.html">
                                <span class="glyphicon glyphicon-pencil"></span>
                                发布文章
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading3">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                           href="#collapse3"
                           aria-expanded="false" aria-controls="collapseThree">
                            <span class="glyphicon glyphicon-equalizer"></span>
                            栏目管理
                        </a>
                    </h4>
                </div>
                <div id="collapse3" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="category-list.html">
                                <span class="glyphicon glyphicon-list"></span>
                                栏目列表
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="category-add.html">
                                <span class="glyphicon glyphicon-plus"></span>
                                添加栏目
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading4">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                           href="#collapse4"
                           aria-expanded="false" aria-controls="collapseThree">
                            <span class="glyphicon glyphicon-bullhorn"></span>
                            公告管理
                        </a>
                    </h4>
                </div>
                <div id="collapse4" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="#">
                                <span class="glyphicon glyphicon-bell"></span>
                                公告列表
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="#">
                                <span class="glyphicon glyphicon-send"></span>
                                发布公告
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading5">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                           href="#collapse5"
                           aria-expanded="false" aria-controls="collapseThree">
                            <span class="glyphicon glyphicon-comment"></span>
                            评论管理
                        </a>
                    </h4>
                </div>
                <div id="collapse5" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="#">
                                <span class="glyphicon glyphicon-paperclip"></span>
                                评论列表
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading6">
                    <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion"
                           href="#collapse6"
                           aria-expanded="false" aria-controls="collapseThree">
                            <span class="glyphicon glyphicon-user"></span>
                            用户管理
                        </a>
                    </h4>
                </div>
                <div id="collapse6" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingThree">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="#">
                                <span class="glyphicon glyphicon-tags"></span>
                                用户组
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="user-list.html">
                                <span class="glyphicon glyphicon-list-alt"></span>
                                用户列表
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="right-content">
        <!-- 表格 -->
        <div class="panel panel-primary">
            <div class="panel-heading">用户列表</div>
            <div class="panel-body">
                <!-- Table -->
                <table class="table">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>用户名</th>
                        <th>姓名</th>
                        <th>手机</th>
                        <th>角色</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!--							<tr>-->
                    <!--								<td>1</td>-->
                    <!--								<td>moz</td>-->
                    <!--								<td>黄小米</td>-->
                    <!--								<td>15863008280</td>-->
                    <!--								<td>管理员</td>-->
                    <!--								<td>-->
                    <!--									<button type="button" class="btn btn-default btn-xs">-->
                    <!--										<span class="glyphicon glyphicon-edit" aria-hidden="true"></span> 编辑-->
                    <!--									</button>-->
                    <!--									<button type="button" class="btn btn-default btn-xs">-->
                    <!--										<span class="glyphicon glyphicon-trash" aria-hidden="true"></span> 删除-->
                    <!--									</button>-->
                    <!--								</td>-->
                    <!--							</tr>-->
                    </tbody>
                </table>
            </div>


        </div>
    </div>
</div>
<!--模态框-->
<div class="modal fade" tabindex="-1" role="dialog" id="deleteModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">删除</h4>
            </div>
            <div class="modal-body">
                <p>确定要删除吗?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="confirmBtn">确定</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="editModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">编辑</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="exampleInputUsername1">用户</label>
                        <input type="email" class="form-control" id="exampleInputUsername1">
                        <span class="glyphicon  form-control-feedback" aria-hidden="true"></span>
                    </div>
                    <div class="form-group">
                        <label for="exampleInputName1">姓名</label>
                        <input type="text" class="form-control" id="exampleInputName1">
                        <span class="glyphicon  form-control-feedback" aria-hidden="true"></span>
                    </div>
                    <div class="form-group">
                        <label for="exampleInputTel">手机</label>
                        <input type="text" class="form-control" id="exampleInputTel">
                        <span class="glyphicon  form-control-feedback" aria-hidden="true"></span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="confirmBtn2">保存</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="lib/jQuery/jquery-1.12.4.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="lib/bootstrap-3.3.7/js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        //获取用户列表
        $.getJSON("/users/list", function (results) {
            if (results.status) {
                var html = "";
                $(results.data).each(function (index, item) {
                    html += `<tr>
\t\t\t\t\t\t\t\t<td>${item.user_id}</td>
\t\t\t\t\t\t\t\t<td class="username">${item.username}</td>
\t\t\t\t\t\t\t\t<td class="fullname">${item.fullname}</td>
\t\t\t\t\t\t\t\t<td class="tel">${item.tel}</td>
\t\t\t\t\t\t\t\t<td>管理员</td>
\t\t\t\t\t\t\t\t<td>
\t\t\t\t\t\t\t\t\t<button type="button" class="btn btn-default btn-xs edit" data-id="${item.user_id}">
\t\t\t\t\t\t\t\t\t\t<span class="glyphicon glyphicon-edit" aria-hidden="true"></span> 编辑
\t\t\t\t\t\t\t\t\t</button>
\t\t\t\t\t\t\t\t\t<button type="button" class="btn btn-default btn-xs delete" data-id="${item.user_id}">
\t\t\t\t\t\t\t\t\t\t<span class="glyphicon glyphicon-trash" aria-hidden="true"></span> 删除
\t\t\t\t\t\t\t\t\t</button>
\t\t\t\t\t\t\t\t</td>
\t\t\t\t\t\t\t</tr>`
                });
                $("table tbody").append(html);
            }
        });
        //删除用户
        $("tbody").on("click", ".delete", function () {
            var uid = $(this).data("id");
            $("#confirmBtn").data("id", uid);
            $('#deleteModal').modal("show");
        })
//确认删除
        $("#confirmBtn").click(function () {
            var uid = $(this).data("id");
            $.post("/users/delete", {id: uid}, function (results) {
                if (results.status) {
                    $('#deleteModal').modal('hide')
                    //刷新页面 location.reload()
                    $("tbody>tr").each(function () {
                        var $td = $(this).find("td").eq(0)
                        var id = $.trim($td.text());
                        if (id == uid) {
                            $(this).remove();
                        }
                    })
                }
            });
        })
//编辑
        var edit
        $("tbody").on("click", ".edit", function () {
            edit=$(this);
            var uid = $(this).data("id");
            $("#confirmBtn2").data("id",uid);
            $.get("/users/datail", {id: uid}, function (results) {
                $("#exampleInputUsername1").val(results.data.username)
                $("#exampleInputName1").val(results.data.fullname)
                $("#exampleInputTel").val(results.data.tel)
            })
            $('#editModal').modal("show");
        })
//确认编辑
        $("#confirmBtn2").click(function () {
            var username = $("#exampleInputUsername1").val();
            var fullname = $("#exampleInputName1").val();
            var tel = $("#exampleInputTel").val();

            var userRes = /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
            var nameRes = /^[\u4E00-\u9FA5\uf900-\ufa2d·s]{2,20}$/;
            var telRes = /^1[3|7|8|5]{1}\d{9}$/;
            var flag1 = userRes.test(username);
            var flag2 = nameRes.test(fullname);
            var flag3 = telRes.test(tel);
            if (flag1) {
                $("#exampleInputUsername1").parents(".form-group").removeClass("has-error").addClass("has-success has-feedback");
                $("#exampleInputUsername1").parents(".form-group").find("span").addClass("glyphicon-ok").removeClass(
                    "glyphicon-remove");
            } else {
                $("#exampleInputUsername1").parents(".form-group").addClass("has-error has-feedback").remove("has-success");
                $("#exampleInputUsername1").parents(".form-group").find("span").removeClass("glyphicon-ok").addClass(
                    "glyphicon-remove");
            }
            if (flag2) {
                $("#exampleInputName1").parents(".form-group").removeClass("has-error").addClass("has-success has-feedback");
                $("#exampleInputName1").parents(".form-group").find("span").addClass("glyphicon-ok").removeClass(
                    "glyphicon-remove");
            } else {
                $("#exampleInputName1").parents(".form-group").addClass("has-error has-feedback");
                $("#exampleInputName1").parents(".form-group").find("span").removeClass("glyphicon-ok").addClass(
                    "glyphicon-remove");
            }
            if (flag3) {
                $("#exampleInputTel").parents(".form-group").removeClass("has-error").addClass("has-success has-feedback");
                $("#exampleInputTel").parents(".form-group").find("span").addClass("glyphicon-ok").removeClass("glyphicon-remove");
            } else {
                $("#exampleInputTel").parents(".form-group").addClass("has-error has-feedback");
                $("#exampleInputTel").parents(".form-group").find("span").removeClass("glyphicon-ok").addClass("glyphicon-remove");
            }
            if (flag1 && flag2 && flag3) {
                var uid = $("#confirmBtn2").data("id");
                console.log(uid)
                $.post("/users/edit", {user_id: uid,username:username,fullname:fullname,tel:tel}, function (results) {
                    console.log(results);
                    if (results.status) {
                        $('#editModal').modal('hide')
                        //刷新页面 location.reload()
                     var tr=edit.parents("tr");
                        tr.find(".username").text(username);
                        tr.find(".fullname").text(fullname);
                        tr.find(".tel").text(tel);
                    }
                });
            }

        })

        // //实例:同步传输
        // $.ajax({
        //     type: "GET",
        //     url: "/users/list",
        //     async: true,
        //     success:function () {
        //         console.log(1)
        //     }
        // })
        // $.ajax({
        //     type: "GET",
        //     url: "/users/list",
        //     async: true,
        //     success:function () {
        //         console.log(2)
        //     }
        // })
        // console.log(3);


    });
</script>
</body>

</html>